<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Sistema Chatbot Dante Propiedades</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            background: #f5f5f5; 
            line-height: 1.6;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-result { 
            padding: 15px; 
            margin: 10px 0; 
            border-radius: 8px; 
            border-left: 4px solid;
        }
        .success { 
            background: #d4edda; 
            color: #155724; 
            border-left-color: #28a745;
        }
        .error { 
            background: #f8d7da; 
            color: #721c24; 
            border-left-color: #dc3545;
        }
        .warning {
            background: #fff3cd;
            color: #856404;
            border-left-color: #ffc107;
        }
        #console-log { 
            background: #1e1e1e; 
            color: #00ff00; 
            padding: 20px; 
            border-radius: 8px; 
            font-family: 'Courier New', monospace; 
            white-space: pre-wrap; 
            max-height: 400px; 
            overflow-y: auto; 
            font-size: 12px;
        }
        .action-buttons {
            margin: 20px 0;
        }
        .btn {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        .btn:hover {
            background: #0056b3;
        }
        .btn-success {
            background: #28a745;
        }
        .btn-warning {
            background: #ffc107;
            color: #000;
        }
        .btn-danger {
            background: #dc3545;
        }
        .filters-test {
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        .filter-status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            margin: 2px;
        }
        .filter-loaded {
            background: #d4edda;
            color: #155724;
        }
        .filter-missing {
            background: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <h1>üß™ Test Completo - Sistema Chatbot Dante Propiedades</h1>
    
    <div class="action-buttons">
        <button class="btn btn-success" onclick="runAllTests()">üöÄ Ejecutar Tests Completos</button>
        <button class="btn btn-warning" onclick="clearConsole()">üóëÔ∏è Limpiar Console</button>
        <button class="btn btn-danger" onclick="testMenuButtons()">üî¢ Test Men√∫ Num√©rico</button>
    </div>

    <div class="test-section">
        <h2>üìã Resultados de Tests</h2>
        <div id="test-results"></div>
    </div>
    
    <div class="test-section">
        <h2>üîß Estado de Filtros</h2>
        <div class="filters-test">
            <h4>Filtros de B√∫squeda Avanzada:</h4>
            <div id="filters-status"></div>
        </div>
    </div>
    
    <div class="test-section">
        <h2>üìã Console Log del Sistema</h2>
        <div id="console-log"></div>
    </div>

    <div class="test-section">
        <h2>üî¢ Test del Men√∫ R√°pido</h2>
        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; max-width: 400px;">
            <button class="btn" onclick="testMenuInput('1')">1 - Buscar por Barrio</button>
            <button class="btn" onclick="testMenuInput('2')">2 - Buscar por Tipo</button>
            <button class="btn" onclick="testMenuInput('3')">3 - Buscar por Precio</button>
            <button class="btn btn-warning" onclick="testMenuInput('0')">0 - Ayuda</button>
        </div>
    </div>

    <script>
        // Capture console logs
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        const logContainer = document.getElementById('console-log');
        
        function addToLog(message, type = 'log') {
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#ff6b6b' : type === 'warn' ? '#ffd93d' : type === 'info' ? '#74c0fc' : '#51cf66';
            logContainer.innerHTML += `<span style="color: ${color}">[${timestamp}] ${message}</span>\n`;
            logContainer.scrollTop = logContainer.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addToLog(args.join(' '), 'log');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addToLog('ERROR: ' + args.join(' '), 'error');
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            addToLog('WARNING: ' + args.join(' '), 'warn');
        };

        console.info = function(...args) {
            addToLog('INFO: ' + args.join(' '), 'info');
        };

        function addTestResult(test, success, message) {
            const resultsDiv = document.getElementById('test-results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${success ? 'success' : 'error'}`;
            resultDiv.innerHTML = `${success ? '‚úÖ' : '‚ùå'} <strong>${test}</strong>: ${message}`;
            resultsDiv.appendChild(resultDiv);
        }

        function updateFiltersStatus() {
            const statusDiv = document.getElementById('filters-status');
            const filters = ['barrio-select', 'tipo-select', 'operacion-select'];
            let loadedFilters = 0;
            
            filters.forEach(filterId => {
                const select = document.getElementById(filterId);
                if (select) {
                    const options = select.querySelectorAll('option');
                    const loaded = options.length > 1; // More than just "All" option
                    
                    const span = document.createElement('span');
                    span.className = `filter-status ${loaded ? 'filter-loaded' : 'filter-missing'}`;
                    span.textContent = `${filterId}: ${loaded ? 'Cargado (' + (options.length - 1) + ' opciones)' : 'Vac√≠o'}`;
                    statusDiv.appendChild(span);
                    
                    if (loaded) loadedFilters++;
                }
            });
            
            return loadedFilters === filters.length;
        }

        async function runAllTests() {
            console.log('üöÄ INICIANDO TESTS COMPLETOS DEL SISTEMA...');
            console.log('=' * 50);
            
            // Limpiar resultados anteriores
            document.getElementById('test-results').innerHTML = '';
            
            try {
                // Test 1: Verificar sintaxis JavaScript
                console.log('üìù Test 1: Verificando sintaxis JavaScript...');
                const jsFiles = ['config.js', 'utils.js', 'property-manager.js', 'chatbot.js', 'menu-system.js', 'gallery.js', 'favorites.js'];
                let jsOk = 0;
                
                for (const file of jsFiles) {
                    try {
                        const response = await fetch(`js/${file}`);
                        if (response.ok) {
                            console.log(`‚úÖ ${file} - Archivo disponible`);
                            jsOk++;
                        } else {
                            console.log(`‚ùå ${file} - No disponible`);
                        }
                    } catch (e) {
                        console.log(`‚ùå ${file} - Error: ${e.message}`);
                    }
                }
                
                if (jsOk === jsFiles.length) {
                    addTestResult('Archivos JavaScript', true, `Todos los archivos JS disponibles (${jsOk}/${jsFiles.length})`);
                } else {
                    addTestResult('Archivos JavaScript', false, `Solo ${jsOk}/${jsFiles.length} archivos disponibles`);
                }

                // Test 2: Verificar datos JSON
                console.log('üìÑ Test 2: Verificando propiedades.json...');
                const propiedadesResponse = await fetch('propiedades.json');
                if (propiedadesResponse.ok) {
                    const propiedades = await propiedadesResponse.json();
                    console.log(`‚úÖ propiedades.json cargado - ${propiedades.length} propiedades`);
                    
                    // Analizar tipos de propiedades
                    const tipos = [...new Set(propiedades.map(p => p.tipo))];
                    const barrios = [...new Set(propiedades.map(p => p.barrio))];
                    const operaciones = [...new Set(propiedades.map(p => p.operacion))];
                    
                    console.log(`üìä Tipos: ${tipos.join(', ')}`);
                    console.log(`üìä Barrios: ${barrios.join(', ')}`);
                    console.log(`üìä Operaciones: ${operaciones.join(', ')}`);
                    
                    addTestResult('Datos JSON', true, `${propiedades.length} propiedades cargadas correctamente`);
                    
                    // Test 3: Verificar im√°genes
                    console.log('üñºÔ∏è Test 3: Verificando im√°genes...');
                    let imagesOk = 0;
                    let totalImages = 0;
                    
                    for (const prop of propiedades.slice(0, 3)) { // Solo primeras 3 propiedades
                        if (prop.fotos) {
                            for (const foto of prop.fotos.slice(0, 2)) { // Solo primeras 2 fotos
                                totalImages++;
                                try {
                                    const imgResponse = await fetch(foto);
                                    if (imgResponse.ok) {
                                        imagesOk++;
                                        console.log(`‚úÖ ${foto}`);
                                    } else {
                                        console.log(`‚ö†Ô∏è ${foto} - Status: ${imgResponse.status}`);
                                    }
                                } catch (e) {
                                    console.log(`‚ùå ${foto} - Error: ${e.message}`);
                                }
                            }
                        }
                    }
                    
                    addTestResult('Im√°genes', imagesOk > 0, `${imagesOk}/${totalImages} im√°genes verificadas`);
                    
                } else {
                    throw new Error('propiedades.json no disponible');
                }

                // Test 4: Verificar elementos HTML
                console.log('üèóÔ∏è Test 4: Verificando elementos HTML...');
                const htmlElements = ['barrio-select', 'tipo-select', 'operacion-select', 'searchBtn', 'messageInput'];
                let htmlOk = 0;
                
                for (const elementId of htmlElements) {
                    const element = document.getElementById(elementId);
                    if (element) {
                        console.log(`‚úÖ ${elementId} - Presente`);
                        htmlOk++;
                    } else {
                        console.log(`‚ùå ${elementId} - Falta`);
                    }
                }
                
                addTestResult('Elementos HTML', htmlOk === htmlElements.length, `${htmlOk}/${htmlElements.length} elementos encontrados`);

                // Test 5: Verificar funcionalidades del sistema
                console.log('üîß Test 5: Verificando funcionalidades...');
                
                // Verificar si los objetos globales est√°n disponibles
                const globals = ['PropertyManager', 'Chatbot', 'MenuSystem', 'Gallery', 'Favorites'];
                let globalsOk = 0;
                
                for (const global of globals) {
                    if (window[global]) {
                        console.log(`‚úÖ ${global} - Disponible`);
                        globalsOk++;
                    } else {
                        console.log(`‚ùå ${global} - No disponible`);
                    }
                }
                
                addTestResult('Objetos Globales', globalsOk === globals.length, `${globalsOk}/${globals.length} objetos disponibles`);

                // Test 6: Estado de filtros despu√©s de 3 segundos
                setTimeout(() => {
                    console.log('üîç Test 6: Verificando estado de filtros...');
                    const filtersLoaded = updateFiltersStatus();
                    addTestResult('Carga de Filtros', filtersLoaded, filtersLoaded ? 'Filtros poblados correctamente' : 'Filtros no se han cargado');
                }, 3000);

                console.log('üéâ TESTS COMPLETADOS!');
                console.log('=' * 50);
                
            } catch (error) {
                console.error('‚ùå Error durante los tests:', error);
                addTestResult('Sistema General', false, error.message);
            }
        }

        function clearConsole() {
            document.getElementById('console-log').innerHTML = '';
            console.log('üóëÔ∏è Console limpiado');
        }

        function testMenuInput(input) {
            console.log(`üî¢ Test de men√∫ con input: "${input}"`);
            if (window.handleMenuInput) {
                window.handleMenuInput(input);
            } else {
                console.log('‚ùå handleMenuInput no disponible');
            }
        }

        function testMenuButtons() {
            console.log('üî¢ Probando todos los botones del men√∫...');
            ['1', '2', '3', '0'].forEach(input => {
                setTimeout(() => testMenuInput(input), 1000);
            });
        }
        
        // Ejecutar tests autom√°ticamente cuando la p√°gina cargue
        window.addEventListener('load', () => {
            console.log('üì± P√°gina de test cargada');
            setTimeout(runAllTests, 1000);
        });
    </script>
</body>
</html>